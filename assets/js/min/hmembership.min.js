/*! htmline-membership 2020-09-11 */

var $=jQuery,hmembership=function(){var e={};$("html").attr("dir")&&$("html").attr("dir");e.init=function(){t(),p(),d()};var t=function(){var e=$(".hmembership-admin-box-content-sortable");e.length&&(e.sortable({start:n,stop:i,update:r}).disableSelection(),$(".add-section").click(function(){s($(this))}),e.on("click",".remove-section",function(){c($(this))}))},n=function(e,t){$(t.item).parent().children().find('input[type="radio"]').each(function(){$(this).prop("checked")?$(this).attr("data-checked",!0):$(this).attr("data-checked",!1)})},i=function(e,t){$(t.item).parent().children().find('input[type="radio"]').each(function(){"true"==$(this).attr("data-checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)})},r=function(e,t){$(t.item).parent().children().each(function(e,t){o($(t),e+1)})},s=function(e){var t=e.prev(),n=t.children(),i=$(".hmembership-dynamic-section-template").children().clone(!0);a(i),t.parent().hasClass("no-sections")?t.parent().removeClass("no-sections"):o(i,n.length+1),i.appendTo(t)},a=function(e){e.find('input[type="text"],input[type="password"],input[type="number"],textarea').val(""),e.find("select").children().removeAttr("selected"),e.find('input[type="radio"],input[type="checkbox"]').removeAttr("checked")},o=function(e,t){e.find('input[type="text"],input[type="password"],input[type="number"],textarea,select').each(function(){var e=(e=$(this).attr("id")).substring(0,e.lastIndexOf("_"));$(this).attr("id",e+"_"+t),$(this).closest("tr").find("label").attr("for",e+"_"+t)}),e.find('input[type="radio"],input[type="checkbox"]').each(function(){var e=$(this).attr("id");suffixPos=e.lastIndexOf("_"),suffix=e.substring(suffixPos),prefix=e.substring(0,e.lastIndexOf("_")),prefix=prefix.substring(0,prefix.lastIndexOf("_")),$(this).attr("id",prefix+"_"+t+suffix),$(this).parent("label").attr("for",prefix+"_"+t+suffix),$(this).closest("tr").children("th").children("label").attr("for",prefix+"_"+t)}),e.find('select,input[type="radio"],input[type="checkbox"],input[type="hidden"]').each(function(){var e=$(this).attr("name");suffixPos=e.lastIndexOf("[]"),suffix=e.substring(suffixPos),prefix=e.substring(0,e.lastIndexOf("[")),prefix=prefix.substring(0,prefix.lastIndexOf("[")),$(this).attr("name",prefix+"["+(t-1)+"]"+suffix)})},c=function(e){var t=e.parent(),n=t.parent(),i=n.children();t.remove(),(i=n.children()).each(function(e,t){o($(t),e+1)}),i.length||n.parent().addClass("no-sections")},p=function(){var e=$(".wp-list-table.hmembership-users");e.length&&e.find(".column-user_info").children(".expand").on("click",function(){var e=$(this).children(),t=$(this).next();e.toggleClass("open"),t.toggleClass("open")})},d=function(){$("body").on("click",".hmembership-export-users",function(){h($(this))})},h=function(e){var t=_hmembership.settings.export_users;e.hasClass("disabled")||e.hasClass("active")||!t||(e.addClass("active"),f(e))},f=function(n){var e=n.data("nonce"),i=$(".export-users-summary");i.html(""),$.ajax({type:"post",dataType:"text",url:_hmembership.ajaxurl,cache:!1,data:{action:"hmembership_export_users",nonce:e},success:function(e,t,n){e.length?l(e,n):i.html(_hmembership.strings.failed_export)},error:function(e,t,n){i.html(_hmembership.strings.failed_export)},complete:function(e,t){n.removeClass("active")}})},l=function(e,t){var n,i="",r=t.getResponseHeader("Content-Disposition");!r||-1===r.indexOf("attachment")||null!=(n=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(r))&&n[1]&&(i=n[1].replace(/['"]/g,""));var s,a,o,c=t.getResponseHeader("Content-Type"),p=new Blob([e],{type:c});void 0!==window.navigator.msSaveBlob?window.navigator.msSaveBlob(p,i):(s=window.URL||window.webkitURL,a=s.createObjectURL(p),!i||void 0===(o=document.createElement("a")).download?window.location.href=a:(o.href=a,o.download=i,document.body.appendChild(o),o.click()),setTimeout(function(){s.revokeObjectURL(a)},100))};return e}();hmembership.init();